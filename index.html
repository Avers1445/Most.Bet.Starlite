<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Реферальный редирект</title>
  <script>
    const subIds = ["sub1", "sub2", "sub3"];

    function getNextSubId() {
      let currentIndex = localStorage.getItem("currentSubIndex");
      if (currentIndex === null) {
        currentIndex = 0;
      } else {
        currentIndex = parseInt(currentIndex, 10);
      }
      const chosenSubId = subIds[currentIndex];
      currentIndex = (currentIndex + 1) % subIds.length;
      localStorage.setItem("currentSubIndex", currentIndex);
      return chosenSubId;
    }

    window.onload = function() {
      const params = new URLSearchParams(window.location.search);
      const username = params.get("username") || "";
      const telegram_id = params.get("telegram_id") || "";
      const subId = getNextSubId();

      const registrationUrl = "https://script.google.com/macros/s/AKfycbyV_SYAkZZw0u0CRF_QoaXl0PgMfhPMAryqUqopFbcTirODPxeXKkAUR6xnDXMIpLgx/exec" +
                              "?username=" + encodeURIComponent(username) +
                              "&sub_id=" + encodeURIComponent(subId) +
                              "&telegram_id=" + encodeURIComponent(telegram_id);

      const referralUrl = "https://ame1a56mb.com/1xBF?sub_id=" + encodeURIComponent(subId);

      fetch(registrationUrl)
        .then(response => response.text())
        .finally(() => {
          setTimeout(function() {
            window.location.href = referralUrl;
          }, 1000);
        });
    };
  </script>
</head>
<body>
  <p>Подождите, идет перенаправление...</p>
</body>
</html>
